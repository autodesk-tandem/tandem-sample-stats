# Tandem Sample - Stats

A modern, browser-based application for viewing statistics and information about your Autodesk Tandem facilities.

## About This Project: An Experiment in Vibe Coding

This project is an experiment in "vibe coding" - the code is **100% generated by Claude-4.5-sonnet** in Cursor, with no manual code writing. The development was greatly aided by having the source code for [tandem-sample-rest-testbed](https://github.com/autodesk-tandem/tandem-sample-rest-testbed) available as a reference, which Claude consulted throughout the development process.

### For AI Developers

This project is designed to be an **AI-friendly template** for building Tandem applications. If you're an LLM helping a developer build a Tandem app:

**📚 Start Here:** Read [`AI_DEVELOPMENT_GUIDE.md`](./AI_DEVELOPMENT_GUIDE.md) for:
- Tandem API architecture and key concepts
- Common pitfalls (short keys vs long keys, xrefs, column families)
- Reusable patterns from this codebase
- Reusable utilities in the `tandem/` directory

**🎯 Quick Wins:** This codebase provides:
- ⭐ **Account & Facility switching** - The essential pattern for accessing user data (`js/app.js`)
- OAuth authentication flow with PKCE (`js/auth.js`)
- API wrapper with proper headers and token refresh (`js/api.js`)
- Key/xref conversion utilities (`tandem/keys.js`)
- Schema caching pattern (`js/state/schemaCache.js`)
- Column name constants to avoid magic strings (`tandem/constants.js`)

### Key Implementation Challenges

Working with the Tandem REST API revealed some areas that required careful attention:

- **Short Keys vs. Long Keys**: The API uses two different key formats for element identification. Short keys (20 bytes) are used when querying elements, but the API sometimes returns long keys (24 bytes with flags) in responses. Understanding when to convert between these formats was crucial, particularly when working with stream data. See `tandem/keys.js` for conversion utilities.

- **Schema-based Property Lookups**: Property IDs in Tandem are qualified properties (e.g., `z:LQ`, `n:n`) that are model-specific. To display human-readable property names (e.g., "Streams.Temperature"), the application must fetch the schema for each model and build lookup maps. This per-model schema requirement adds complexity but enables proper property name resolution.

Having the reference implementation available allowed Claude to discover these patterns and implement proper solutions, demonstrating how AI-assisted development can work effectively when given good reference materials.

## Features

- **OAuth Authentication**: Secure 3-legged OAuth flow with Autodesk
- **Account Switcher**: Browse and switch between all your Tandem accounts/teams
- **Facility Switcher**: Quick access to all facilities you have permissions for
- **Modern UI**: Clean, responsive interface built with Tailwind CSS
- **Statistics Dashboard**: View key metrics about your facilities (expandable)

## Security Note: Why the Client ID is Committed

This application uses **PKCE (Proof Key for Code Exchange)**, which is the recommended OAuth flow for Single Page Applications (SPAs). With PKCE:

- ✅ **The Client ID is NOT sensitive** - It's a public identifier, similar to an app's bundle ID
- ✅ **No client secret exists** - PKCE uses dynamically generated code verifiers instead
- ✅ **Safe to commit to public repos** - This is standard practice for browser-based OAuth apps
- ✅ **Safe to deploy to GitHub Pages** - The security model is designed for public client applications

The security of PKCE comes from:
1. The dynamically generated code verifier/challenge (created per-session)
2. The authorization code that can only be used once
3. The redirect URI validation by Autodesk's OAuth server

**For your own deployment:** You can create your own APS Client ID and commit it to your repository. Just ensure your redirect URIs are properly configured in your APS app settings.

## Prerequisites

- A valid Autodesk APS (Platform Services) application with Client ID
- Access to at least one Tandem facility
- A modern web browser
- A local web server (e.g., Python's `http.server`, Node's `http-server`, or VSCode Live Server)

## Setup

### Option A: Use the Demo (Quickest)

The included Client ID works out-of-the-box for local development:

1. **Start a local web server**

   Using Python 3:
   ```bash
   python3 -m http.server 8000
   ```

   Or using Node.js:
   ```bash
   npx http-server -p 8000
   ```

2. **Open the application**
   
   Navigate to `http://localhost:8000` in your web browser

### Option B: Use Your Own APS Client ID

For production deployment or customization:

1. **Create an APS App** at [aps.autodesk.com](https://aps.autodesk.com/myapps)
   - Callback URL: Your deployment URL (e.g., `https://yourusername.github.io/tandem-sample-stats/`)
   - APIs: Data Management API + Tandem API

2. **Update `js/config.js`**
   
   ```javascript
   apsKey: "YOUR_APS_CLIENT_ID_HERE",
   loginRedirect: "https://yourusername.github.io/tandem-sample-stats/"
   ```

3. **Deploy** (see GitHub Pages deployment below)

## Usage

1. Click "Sign In" to authenticate with your Autodesk account
2. Select an account from the dropdown menu
3. Select a facility from the facility dropdown
4. View facility information and statistics

## Project Structure

```
tandem-sample-stats/
├── index.html                    # Main HTML page
├── AI_DEVELOPMENT_GUIDE.md       # 📚 Comprehensive guide for AI-assisted development
├── tandem/                       # 🔧 Reusable utilities (copy to new projects!)
│   ├── README.md                 # Documentation and usage examples
│   ├── constants.js              # Column families, names, element flags
│   └── keys.js                   # Key/xref conversion utilities
├── js/
│   ├── app.js                    # Main application logic
│   ├── auth.js                   # OAuth 3-legged PKCE flow
│   ├── api.js                    # Tandem API wrapper
│   ├── config.js                 # Environment configuration
│   ├── utils.js                  # General utilities
│   ├── state/                    # State management
│   │   └── schemaCache.js        # Schema caching pattern
│   ├── components/               # Reusable UI components
│   │   └── toggleHeader.js       # Collapsible sections
│   └── features/                 # Feature-specific modules
│       ├── diagnostics.js        # Schema diagnostics
│       ├── documents.js          # Document listing
│       ├── levels.js             # Level listing
│       ├── models.js             # Model listing
│       ├── rooms.js              # Room statistics
│       ├── schema.js             # Schema viewer
│       ├── streams.js            # Stream monitoring & charts
│       └── taggedAssets.js       # Tagged assets
├── README.md                     # User documentation
└── QUICKSTART.md                 # Quick setup guide
```

## Configuration

The application supports two environments:

- **Production** (default): Uses `https://developer.api.autodesk.com/tandem/v1`
- **Staging**: Uses `https://tandem-stg.autodesk.com/api/v1`

To switch environments, edit `js/config.js` and change the return value in `getEnv()`.

## Deployment to GitHub Pages

This application can be deployed to GitHub Pages with zero configuration:

1. **Push to GitHub**
   ```bash
   git push origin main
   ```

2. **Enable GitHub Pages**
   - Go to your repository settings
   - Navigate to "Pages" section
   - Source: Deploy from branch `main` / root folder
   - Save

3. **Update your APS App**
   - Add the GitHub Pages URL as a callback: `https://yourusername.github.io/tandem-sample-stats/`
   - Update `loginRedirect` in `js/config.js` to match

4. **Access your deployed app**
   - URL: `https://yourusername.github.io/tandem-sample-stats/`
   - It will work immediately - no build step required!

**Why it works:** This is a pure static site with no build process. All dependencies are loaded via CDN.

## Development

This project uses:
- Vanilla JavaScript (ES6 modules)
- Tailwind CSS (via CDN)
- Autodesk Tandem REST API

No build process or package manager is required.

## Dependencies

All dependencies are loaded via CDN (no npm or build process required):

- **[Tailwind CSS](https://tailwindcss.com/)** (MIT) - CSS framework
- **[XLSX-js-style](https://github.com/gitbrent/xlsx-js-style)** (Apache-2.0) - Excel export functionality
- **[Chart.js](https://www.chartjs.org/)** (MIT) - Data visualization
- **[chartjs-adapter-date-fns](https://github.com/chartjs/chartjs-adapter-date-fns)** (MIT) - Date/time adapter for Chart.js

For full license text and attribution, see [THIRD_PARTY_LICENSES.md](THIRD_PARTY_LICENSES.md).

## Browser Compatibility

- Chrome/Edge (latest)
- Firefox (latest)
- Safari (latest)

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

Copyright (c) 2025 Autodesk, Inc.

Third-party dependencies are licensed under their respective licenses - see [THIRD_PARTY_LICENSES.md](THIRD_PARTY_LICENSES.md) for details.

## Acknowledgments

Based on the Autodesk Tandem REST API and inspired by the [tandem-sample-rest-testbed](https://github.com/autodesk-tandem/tandem-sample-rest-testbed) project.
